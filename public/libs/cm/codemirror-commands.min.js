this.CM=this.CM||{},this.CM.commands=function(e,t,r){"use strict";const n=1024;let i=0;class o{constructor(e,t){this.from=e,this.to=t}}class s{constructor(e={}){this.id=i++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=h.match(e)),t=>{let r=e(t);return void 0===r?null:[this,r]}}}s.closedBy=new s({deserialize:e=>e.split(" ")}),s.openedBy=new s({deserialize:e=>e.split(" ")}),s.group=new s({deserialize:e=>e.split(" ")}),s.isolate=new s({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),s.contextHash=new s({perNode:!0}),s.lookAhead=new s({perNode:!0}),s.mounted=new s({perNode:!0});class l{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[s.mounted.id]}}const a=Object.create(null);class h{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):a,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new h(e.name||"",t,e.id,r);if(e.props)for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(s.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return e=>{for(let r=e.prop(s.group),n=-1;n<(r?r.length:0);n++){let i=t[n<0?e.name:r[n]];if(i)return i}}}}h.none=new h("",Object.create(null),0,8);const u=new WeakMap,f=new WeakMap;var c;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(c||(c={}));class d{constructor(e,t,r,n,i){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,i&&i.length){this.props=Object.create(null);for(let[e,t]of i)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=l.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let r=e.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new B(this.topNode,e)}cursorAt(e,t=0,r=0){let n=u.get(this)||this.topNode,i=new B(n);return i.moveTo(e,t),u.set(this,i._tree),i}get topNode(){return new w(this,0,0,null)}resolve(e,t=0){let r=y(u.get(this)||this.topNode,e,t,!1);return u.set(this,r),r}resolveInner(e,t=0){let r=y(f.get(this)||this.topNode,e,t,!0);return f.set(this,r),r}resolveStack(e,t=0){return function(e,t,r){let n=e.resolveInner(t,r),i=null;for(let e=n instanceof w?n:n.context.parent;e;e=e.parent)if(e.index<0){let o=e.parent;(i||(i=[n])).push(o.resolve(t,r)),e=o}else{let o=l.get(e.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let s=new w(o.tree,o.overlay[0].from+e.from,-1,e);(i||(i=[n])).push(y(s,t,r,!1))}}return i?A(i):n}(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:i=this.length}=e,o=e.mode||0,s=(o&c.IncludeAnonymous)>0;for(let e=this.cursor(o|c.IncludeAnonymous);;){let o=!1;if(e.from<=i&&e.to>=n&&(!s&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;o=!0}for(;o&&r&&(s||!e.type.isAnonymous)&&r(e),!e.nextSibling();){if(!e.parent())return;o=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:N(h.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,r)=>new d(this.type,e,t,r,this.propValues)),e.makeTree||((e,t,r)=>new d(h.none,e,t,r)))}static build(e){return function(e){var t;let{buffer:r,nodeSet:i,maxBufferLength:o=n,reused:l=[],minRepeatType:a=i.types.length}=e,h=Array.isArray(r)?new p(r,r.length):r,u=i.types,f=0,c=0;function g(e,t,r,n,s,d){let{id:p,start:S,end:A,size:C}=h,B=c,E=f;for(;C<0;){if(h.next(),-1==C){let t=l[p];return r.push(t),void n.push(S-e)}if(-3==C)return void(f=p);if(-4==C)return void(c=p);throw new RangeError(`Unrecognized record size: ${C}`)}let D,M,O=u[p],L=S-e;if(A-S<=o&&(M=v(h.pos-t,s))){let t=new Uint16Array(M.size-M.skip),r=h.pos-M.size,n=t.length;for(;h.pos>r;)n=b(M.start,t,n);D=new m(t,A-M.start,i),L=M.start-e}else{let e=h.pos-C;h.next();let t=[],r=[],n=p>=a?p:-1,i=0,s=A;for(;h.pos>e;)n>=0&&h.id==n&&h.size>=0?(h.end<=s-o&&(w(t,r,S,i,h.end,s,n,B,E),i=t.length,s=h.end),h.next()):d>2500?y(S,e,t,r):g(S,e,t,r,n,d+1);if(n>=0&&i>0&&i<t.length&&w(t,r,S,i,S,s,n,B,E),t.reverse(),r.reverse(),n>-1&&i>0){let e=k(O,E);D=N(O,t,r,0,t.length,0,A-S,e,e)}else D=x(O,t,r,A-S,B-A,E)}r.push(D),n.push(L)}function y(e,t,r,n){let s=[],l=0,a=-1;for(;h.pos>t;){let{id:e,start:t,end:r,size:n}=h;if(n>4)h.next();else{if(a>-1&&t<a)break;a<0&&(a=r-o),s.push(e,t,r),l++,h.next()}}if(l){let t=new Uint16Array(4*l),o=s[s.length-2];for(let e=s.length-3,r=0;e>=0;e-=3)t[r++]=s[e],t[r++]=s[e+1]-o,t[r++]=s[e+2]-o,t[r++]=r;r.push(new m(t,s[2]-o,i)),n.push(o-e)}}function k(e,t){return(r,n,i)=>{let o,l,a=0,h=r.length-1;if(h>=0&&(o=r[h])instanceof d){if(!h&&o.type==e&&o.length==i)return o;(l=o.prop(s.lookAhead))&&(a=n[h]+o.length+l)}return x(e,r,n,i,a,t)}}function w(e,t,r,n,o,s,l,a,h){let u=[],f=[];for(;e.length>n;)u.push(e.pop()),f.push(t.pop()+r-o);e.push(x(i.types[l],u,f,s-o,a-s,h)),t.push(o-r)}function x(e,t,r,n,i,o,l){if(o){let e=[s.contextHash,o];l=l?[e].concat(l):[e]}if(i>25){let e=[s.lookAhead,i];l=l?[e].concat(l):[e]}return new d(e,t,r,n,l)}function v(e,t){let r=h.fork(),n=0,i=0,s=0,l=r.end-o,u={size:0,start:0,skip:0};e:for(let o=r.pos-e;r.pos>o;){let e=r.size;if(r.id==t&&e>=0){u.size=n,u.start=i,u.skip=s,s+=4,n+=4,r.next();continue}let h=r.pos-e;if(e<0||h<o||r.start<l)break;let f=r.id>=a?4:0,c=r.start;for(r.next();r.pos>h;){if(r.size<0){if(-3!=r.size)break e;f+=4}else r.id>=a&&(f+=4);r.next()}i=c,n+=e,s+=f}return(t<0||n==e)&&(u.size=n,u.start=i,u.skip=s),u.size>4?u:void 0}function b(e,t,r){let{id:n,start:i,end:o,size:s}=h;if(h.next(),s>=0&&n<a){let l=r;if(s>4){let n=h.pos-(s-4);for(;h.pos>n;)r=b(e,t,r)}t[--r]=l,t[--r]=o-e,t[--r]=i-e,t[--r]=n}else-3==s?f=n:-4==s&&(c=n);return r}let S=[],A=[];for(;h.pos>0;)g(e.start||0,e.bufferStart||0,S,A,-1,0);let C=null!==(t=e.length)&&void 0!==t?t:S.length?A[0]+S[0].length:0;return new d(u[e.topID],S.reverse(),A.reverse(),C)}(e)}}d.empty=new d(h.none,[],[],0);class p{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new p(this.buffer,this.index)}}class m{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return h.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],i=n.name;if(/\W/.test(i)&&!n.isError&&(i=JSON.stringify(i)),r==(e+=4))return i;let o=[];for(;e<r;)o.push(this.childString(e)),e=this.buffer[e+3];return i+"("+o.join(",")+")"}findChild(e,t,r,n,i){let{buffer:o}=this,s=-1;for(let l=e;l!=t&&!(g(i,n,o[l+1],o[l+2])&&(s=l,r>0));l=o[l+3]);return s}slice(e,t,r){let n=this.buffer,i=new Uint16Array(t-e),o=0;for(let s=e,l=0;s<t;){i[l++]=n[s++],i[l++]=n[s++]-r;let t=i[l++]=n[s++]-r;i[l++]=n[s++]-e,o=Math.max(o,t)}return new m(i,o,this.set)}}function g(e,t,r,n){switch(e){case-2:return r<t;case-1:return n>=t&&r<t;case 0:return r<t&&n>t;case 1:return r<=t&&n>t;case 2:return n>t;case 4:return!0}}function y(e,t,r,n){for(var i;e.from==e.to||(r<1?e.from>=t:e.from>t)||(r>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof w&&e.index<0?null:e.parent;if(!t)return e;e=t}let o=n?0:c.IgnoreOverlays;if(n)for(let n=e,s=n.parent;s;n=s,s=n.parent)n instanceof w&&n.index<0&&(null===(i=s.enter(t,r,o))||void 0===i?void 0:i.from)!=n.from&&(e=s);for(;;){let n=e.enter(t,r,o);if(!n)return e;e=n}}class k{cursor(e=0){return new B(this,e)}getChild(e,t=null,r=null){let n=x(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return x(this,e,t,r)}resolve(e,t=0){return y(this,e,t,!1)}resolveInner(e,t=0){return y(this,e,t,!0)}matchContext(e){return v(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(r=t,t=e.prevSibling):t=e}return r}get node(){return this}get next(){return this.parent}}class w extends k{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,i=0){for(let o=this;;){for(let{children:s,positions:a}=o._tree,h=t>0?s.length:-1;e!=h;e+=t){let h=s[e],u=a[e]+o.from;if(g(n,r,u,u+h.length))if(h instanceof m){if(i&c.ExcludeBuffers)continue;let s=h.findChild(0,h.buffer.length,t,r-u,n);if(s>-1)return new S(new b(o,h,e,u),null,s)}else if(i&c.IncludeAnonymous||!h.type.isAnonymous||E(h)){let s;if(!(i&c.IgnoreMounts)&&(s=l.get(h))&&!s.overlay)return new w(s.tree,u,e,o);let a=new w(h,u,e,o);return i&c.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(t<0?h.children.length-1:0,t,r,n)}}if(i&c.IncludeAnonymous||!o.type.isAnonymous)return null;if(e=o.index>=0?o.index+t:t<0?-1:o._parent._tree.children.length,o=o._parent,!o)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let n;if(!(r&c.IgnoreOverlays)&&(n=l.get(this._tree))&&n.overlay){let r=e-this.from;for(let{from:e,to:i}of n.overlay)if((t>0?e<=r:e<r)&&(t<0?i>=r:i>r))return new w(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function x(e,t,r,n){let i=e.cursor(),o=[];if(!i.firstChild())return o;if(null!=r)for(let e=!1;!e;)if(e=i.type.is(r),!i.nextSibling())return o;for(;;){if(null!=n&&i.type.is(n))return o;if(i.type.is(t)&&o.push(i.node),!i.nextSibling())return null==n?o:[]}}function v(e,t,r=t.length-1){for(let n=e;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[r]&&t[r]!=n.name)return!1;r--}}return!0}class b{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class S extends k{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,i=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return i<0?null:new S(this.context,this,i)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&c.ExcludeBuffers)return null;let{buffer:n}=this.context,i=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return i<0?null:new S(this.context,this,i)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new S(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new S(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,i=r.buffer[this.index+3];if(i>n){let o=r.buffer[this.index+1];e.push(r.slice(n,i,o)),t.push(0)}return new d(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function A(e){if(!e.length)return null;let t=0,r=e[0];for(let n=1;n<e.length;n++){let i=e[n];(i.from>r.from||i.to<r.to)&&(r=i,t=n)}let n=r instanceof w&&r.index<0?null:r.parent,i=e.slice();return n?i[t]=n:i.splice(t,1),new C(i,r)}class C{constructor(e,t){this.heads=e,this.node=t}get next(){return A(this.heads)}}class B{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof w)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof w?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,i=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return!(i<0)&&(this.stack.push(this.index),this.yieldBuf(i))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?!(r&c.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&c.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&c.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let e=r<0?0:this.stack[r]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(e)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;({index:t,_parent:r}=r))if(t>-1)for(let n=t+e,i=e<0?-1:r._tree.children.length;n!=i;n+=e){let e=r._tree.children[n];if(this.mode&c.IncludeAnonymous||e instanceof m||!e.type.isAnonymous||E(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,i=this.stack.length;i>=0;){for(let o=e;o;o=o._parent)if(o.index==n){if(n==this.index)return o;t=o,r=i+1;break e}n=this.stack[--i]}for(let e=r;e<this.stack.length;e++)t=new S(this.buffer,t,this.stack[e]);return this.bufferNode=new S(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return v(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,i=this.stack.length-1;n>=0;i--){if(i<0)return v(this._tree,e,n);let o=r[t.buffer[this.stack[i]]];if(!o.isAnonymous){if(e[n]&&e[n]!=o.name)return!1;n--}}return!0}}function E(e){return e.children.some((e=>e instanceof m||!e.type.isAnonymous||E(e)))}const D=new WeakMap;function M(e,t){if(!e.isAnonymous||t instanceof m||t.type!=e)return 1;let r=D.get(t);if(null==r){r=1;for(let n of t.children){if(n.type!=e||!(n instanceof d)){r=1;break}r+=M(e,n)}D.set(t,r)}return r}function N(e,t,r,n,i,o,s,l,a){let h=0;for(let r=n;r<i;r++)h+=M(e,t[r]);let u=Math.ceil(1.5*h/8),f=[],c=[];return function t(r,n,i,s,l){for(let h=i;h<s;){let i=h,d=n[h],p=M(e,r[h]);for(h++;h<s;h++){let t=M(e,r[h]);if(p+t>=u)break;p+=t}if(h==i+1){if(p>u){let e=r[i];t(e.children,e.positions,0,e.children.length,n[i]+l);continue}f.push(r[i])}else{let t=n[h-1]+r[h-1].length-d;f.push(N(e,r,n,i,h,d,t,null,a))}c.push(d+l-o)}}(t,r,n,i,0),(l||a)(f,c,s)}class O{constructor(e,t,r,n,i=!1,o=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=(i?1:0)|(o?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],r=!1){let n=[new O(0,e.length,e,0,!1,r)];for(let r of t)r.to>e.length&&n.push(r);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],i=1,o=e.length?e[0]:null;for(let s=0,l=0,a=0;;s++){let h=s<t.length?t[s]:null,u=h?h.fromA:1e9;if(u-l>=r)for(;o&&o.from<u;){let t=o;if(l>=t.from||u<=t.to||a){let e=Math.max(t.from,l)-a,r=Math.min(t.to,u)-a;t=e>=r?null:new O(e,r,t.tree,t.offset+a,s>0,!!h)}if(t&&n.push(t),o.to>u)break;o=i<e.length?e[i++]:null}if(!h)break;l=h.toA,a=h.toA-h.toB}return n}}class L{startParse(e,t,r){return"string"==typeof e&&(e=new I(e)),r=r?r.length?r.map((e=>new o(e.from,e.to))):[new o(0,0)]:[new o(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let e=n.advance();if(e)return e}}}class I{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new s({perNode:!0});let T=0;class _{constructor(e,t,r,n){this.name=e,this.set=t,this.base=r,this.modified=n,this.id=T++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r="string"==typeof e?e:"?";if(e instanceof _&&(t=e),null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let n=new _(r,[],null,[]);if(n.set.push(n),t)for(let e of t.set)n.set.push(e);return n}static defineModifier(e){let t=new R(e);return e=>e.modified.indexOf(t)>-1?e:R.get(e.base||e,e.modified.concat(t).sort(((e,t)=>e.id-t.id)))}}let P=0;class R{constructor(e){this.name=e,this.instances=[],this.id=P++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find((r=>{return r.base==e&&(n=t,i=r.modified,n.length==i.length&&n.every(((e,t)=>e==i[t])));var n,i}));if(r)return r;let n=[],i=new _(e.name,n,e,t);for(let e of t)e.instances.push(i);let o=function(e){let t=[[]];for(let r=0;r<e.length;r++)for(let n=0,i=t.length;n<i;n++)t.push(t[n].concat(e[r]));return t.sort(((e,t)=>t.length-e.length))}(t);for(let t of e.set)if(!t.modified.length)for(let e of o)n.push(R.get(t,e));return i}}function z(e){let t=Object.create(null);for(let r in e){let n=e[r];Array.isArray(n)||(n=[n]);for(let e of r.split(" "))if(e){let r=[],i=2,o=e;for(let t=0;;){if("..."==o&&t>0&&t+3==e.length){i=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!n)throw new RangeError("Invalid path: "+e);if(r.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),t+=n[0].length,t==e.length)break;let s=e[t++];if(t==e.length&&"!"==s){i=0;break}if("/"!=s)throw new RangeError("Invalid path: "+e);o=e.slice(t)}let s=r.length-1,l=r[s];if(!l)throw new RangeError("Invalid path: "+e);let a=new F(n,i,s>0?r.slice(0,s):null);t[l]=a.sort(t[l])}}return V.add(t)}const V=new s;class F{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}F.empty=new F([],2,null);const U=_.define,W=U(),J=U(),G=U(J),j=U(J),H=U(),$=U(H),q=U(H),K=U(),Q=U(K),X=U(),Y=U(),Z=U(),ee=U(Z),te=U(),re={comment:W,lineComment:U(W),blockComment:U(W),docComment:U(W),name:J,variableName:U(J),typeName:G,tagName:U(G),propertyName:j,attributeName:U(j),className:U(J),labelName:U(J),namespace:U(J),macroName:U(J),literal:H,string:$,docString:U($),character:U($),attributeValue:U($),number:q,integer:U(q),float:U(q),bool:U(H),regexp:U(H),escape:U(H),color:U(H),url:U(H),keyword:X,self:U(X),null:U(X),atom:U(X),unit:U(X),modifier:U(X),operatorKeyword:U(X),controlKeyword:U(X),definitionKeyword:U(X),moduleKeyword:U(X),operator:Y,derefOperator:U(Y),arithmeticOperator:U(Y),logicOperator:U(Y),bitwiseOperator:U(Y),compareOperator:U(Y),updateOperator:U(Y),definitionOperator:U(Y),typeOperator:U(Y),controlOperator:U(Y),punctuation:Z,separator:U(Z),bracket:ee,angleBracket:U(ee),squareBracket:U(ee),paren:U(ee),brace:U(ee),content:K,heading:Q,heading1:U(Q),heading2:U(Q),heading3:U(Q),heading4:U(Q),heading5:U(Q),heading6:U(Q),contentSeparator:U(K),list:U(K),quote:U(K),emphasis:U(K),strong:U(K),link:U(K),monospace:U(K),strikethrough:U(K),inserted:U(),deleted:U(),changed:U(),invalid:U(),meta:te,documentMeta:U(te),annotation:U(te),processingInstruction:U(te),definition:_.defineModifier("definition"),constant:_.defineModifier("constant"),function:_.defineModifier("function"),standard:_.defineModifier("standard"),local:_.defineModifier("local"),special:_.defineModifier("special")};for(let e in re){let t=re[e];t instanceof _&&(t.name=e)}var ne;!function(e){let t=Object.create(null);for(let r of e)if(Array.isArray(r.tag))for(let e of r.tag)t[e.id]=r.class;else t[r.tag.id]=r.class;let{scope:r,all:n=null}={}}([{tag:re.link,class:"tok-link"},{tag:re.heading,class:"tok-heading"},{tag:re.emphasis,class:"tok-emphasis"},{tag:re.strong,class:"tok-strong"},{tag:re.keyword,class:"tok-keyword"},{tag:re.atom,class:"tok-atom"},{tag:re.bool,class:"tok-bool"},{tag:re.url,class:"tok-url"},{tag:re.labelName,class:"tok-labelName"},{tag:re.inserted,class:"tok-inserted"},{tag:re.deleted,class:"tok-deleted"},{tag:re.literal,class:"tok-literal"},{tag:re.string,class:"tok-string"},{tag:re.number,class:"tok-number"},{tag:[re.regexp,re.escape,re.special(re.string)],class:"tok-string2"},{tag:re.variableName,class:"tok-variableName"},{tag:re.local(re.variableName),class:"tok-variableName tok-local"},{tag:re.definition(re.variableName),class:"tok-variableName tok-definition"},{tag:re.special(re.variableName),class:"tok-variableName2"},{tag:re.definition(re.propertyName),class:"tok-propertyName tok-definition"},{tag:re.typeName,class:"tok-typeName"},{tag:re.namespace,class:"tok-namespace"},{tag:re.className,class:"tok-className"},{tag:re.macroName,class:"tok-macroName"},{tag:re.propertyName,class:"tok-propertyName"},{tag:re.operator,class:"tok-operator"},{tag:re.comment,class:"tok-comment"},{tag:re.meta,class:"tok-meta"},{tag:re.invalid,class:"tok-invalid"},{tag:re.punctuation,class:"tok-punctuation"}]);const ie=new s,oe=new s;class se{constructor(e,r,n=[],i=""){this.data=e,this.name=i,t.EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(t.EditorState.prototype,"tree",{get(){return ae(this)}}),this.parser=r,this.extension=[ye.of(this),t.EditorState.languageData.of(((e,t,r)=>{let n=le(e,t,r),i=n.type.prop(ie);if(!i)return[];let o=e.facet(i),s=n.type.prop(oe);if(s){let i=n.resolve(t-n.from,r);for(let t of s)if(t.test(i,e)){let r=e.facet(t.facet);return"replace"==t.type?r:r.concat(o)}}return o}))].concat(n)}isActiveAt(e,t,r=-1){return le(e,t,r).type.prop(ie)==this.data}findRegions(e){let t=e.facet(ye);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(e,t)=>{if(e.prop(ie)==this.data)return void r.push({from:t,to:t+e.length});let i=e.prop(s.mounted);if(i){if(i.tree.prop(ie)==this.data){if(i.overlay)for(let e of i.overlay)r.push({from:e.from+t,to:e.to+t});else r.push({from:t,to:t+e.length});return}if(i.overlay){let e=r.length;if(n(i.tree,i.overlay[0].from+t),r.length>e)return}}for(let r=0;r<e.children.length;r++){let i=e.children[r];i instanceof d&&n(i,e.positions[r]+t)}};return n(ae(e),0),r}get allowsNesting(){return!0}}function le(e,t,r){let n=e.facet(ye),i=ae(e).topNode;if(!n||n.allowsNesting)for(let e=i;e;e=e.enter(t,r,c.ExcludeBuffers))e.type.isTop&&(i=e);return i}function ae(e){let t=e.field(se.state,!1);return t?t.tree:d.empty}se.setState=t.StateEffect.define();class he{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let ue=null;class fe{constructor(e,t,r=[],n,i,o,s,l){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=i,this.viewport=o,this.skipped=s,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new fe(e,t,[],d.empty,0,r,[],null)}startParse(){return this.parser.startParse(new he(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=d.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var r;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n){if(this.fragments=this.withoutTempSkipped(O.addTree(n,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(r=this.parse.stoppedAt)&&void 0!==r?r:this.state.doc.length,this.tree=n,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}}))}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext((()=>{for(;!(t=this.parse.advance()););})),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(O.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=ue;ue=this;try{return e()}finally{ue=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=ce(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:i,viewport:o,skipped:s}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges(((e,r,n,i)=>t.push({fromA:e,toA:r,fromB:n,toB:i}))),r=O.applyChanges(r,t),n=d.empty,i=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){s=[];for(let t of this.skipped){let r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);r<n&&s.push({from:r,to:n})}}}return new fe(this.parser,t,r,n,i,o,s,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:r,to:n}=this.skipped[t];r<e.to&&n>e.from&&(this.fragments=ce(this.fragments,r,n),this.skipped.splice(t--,1))}return!(this.skipped.length>=t)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends L{createParse(t,r,n){let i=n[0].from,o=n[n.length-1].to;return{parsedPos:i,advance(){let t=ue;if(t){for(let e of n)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=o,new d(h.none,[],[],o-i)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return ue}}function ce(e,t,r){return O.applyChanges(e,[{fromA:t,toA:r,fromB:t,toB:r}])}class de{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new de(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=fe.create(e.facet(ye).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new de(r)}}se.state=t.StateField.define({create:de.init,update(e,t){for(let e of t.effects)if(e.is(se.setState))return e.value;return t.startState.facet(ye)!=t.state.facet(ye)?de.init(t.state):e.apply(t)}});let pe=e=>{let t=setTimeout((()=>e()),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(pe=e=>{let t=-1,r=setTimeout((()=>{t=requestIdleCallback(e,{timeout:400})}),100);return()=>t<0?clearTimeout(r):cancelIdleCallback(t)});const me="undefined"!=typeof navigator&&(null===(ne=navigator.scheduling)||void 0===ne?void 0:ne.isInputPending)?()=>navigator.scheduling.isInputPending():null,ge=r.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(se.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(se.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=pe(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,i=r.field(se.state);if(i.tree==i.context.tree&&i.context.isDone(n+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!me?Math.max(25,e.timeRemaining()-5):1e9),s=i.context.treeLen<n&&r.doc.length>n+1e3,l=i.context.work((()=>me&&me()||Date.now()>o),n+(s?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(i.context.takeTree(),this.view.dispatch({effects:se.setState.of(new de(i.context))})),this.chunkBudget>0&&(!l||s)&&this.scheduleWork(),this.checkAsyncSchedule(i.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then((()=>this.scheduleWork())).catch((e=>r.logException(this.view.state,e))).then((()=>this.workScheduled--)),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),ye=t.Facet.define({combine:e=>e.length?e[0]:null,enables:e=>[se.state,ge,r.EditorView.contentAttributes.compute([e],(t=>{let r=t.facet(e);return r&&r.name?{"data-language":r.name}:{}}))]}),ke=t.Facet.define(),we=t.Facet.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some((e=>e!=t[0])))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function xe(e){let t=e.facet(we);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function ve(e,t){let r="",n=e.tabSize,i=e.facet(we)[0];if("\t"==i){for(;t>=n;)r+="\t",t-=n;i=" "}for(let e=0;e<t;e++)r+=i;return r}function be(e,r){e instanceof t.EditorState&&(e=new Se(e));for(let t of e.state.facet(ke)){let n=t(e,r);if(void 0!==n)return n}let n=ae(e.state);return n.length>=r?function(e,t,r){let n=t.resolveStack(r),i=t.resolveInner(r,-1).resolve(r,0).enterUnfinishedNodesBefore(r);if(i!=n.node){let e=[];for(let t=i;t&&(t.from!=n.node.from||t.type!=n.node.type);t=t.parent)e.push(t);for(let t=e.length-1;t>=0;t--)n={node:e[t],next:n}}return Ce(n,e,r)}(e,n,r):null}class Se{constructor(e,t={}){this.state=e,this.options=t,this.unit=xe(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:i}=this.options;return null!=n&&n>=r.from&&n<=r.to?i&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),i=this.countColumn(r,e-n),o=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return o>-1&&(i+=o-this.countColumn(r,r.search(/\S|$/))),i}countColumn(e,r=e.length){return t.countColumn(e,this.state.tabSize,r)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),i=this.options.overrideIndentation;if(i){let e=i(n);if(e>-1)return e}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Ae=new s;function Ce(e,t,r){for(let n=e;n;n=n.next){let e=Be(n.node);if(e)return e(De.create(t,r,n))}return 0}function Be(e){let t=e.type.prop(Ae);if(t)return t;let r,n=e.firstChild;if(n&&(r=n.type.prop(s.closedBy))){let t=e.lastChild,n=t&&r.indexOf(t.name)>-1;return e=>function(e,t,r,n,i){let o=e.textAfter,s=o.match(/^\s*/)[0].length,l=n&&o.slice(s,s+n.length)==n||i==e.pos+s,a=function(e){let t=e.node,r=t.childAfter(t.from),n=t.lastChild;if(!r)return null;let i=e.options.simulateBreak,o=e.state.doc.lineAt(r.from),s=null==i||i<=o.from?o.to:Math.min(o.to,i);for(let e=r.to;;){let i=t.childAfter(e);if(!i||i==n)return null;if(!i.type.isSkipped){if(i.from>=s)return null;let e=/^ */.exec(o.text.slice(r.to-o.from))[0].length;return{from:r.from,to:r.to+e}}e=i.to}}(e);return a?l?e.column(a.from):e.column(a.to):e.baseIndent+(l?0:e.unit*r)}(e,0,1,void 0,n&&!function(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?Ee:null}function Ee(){return 0}class De extends Se{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new De(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(Me(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return Ce(this.context.next,this.base,this.pos)}}function Me(e,t){for(let r=t;r;r=r.parent)if(e==r)return!0;return!1}const Ne=new s;function Oe(e,t,r){let n=e.prop(t<0?s.openedBy:s.closedBy);if(n)return n;if(1==e.name.length){let n=r.indexOf(e.name);if(n>-1&&n%2==(t<0?1:0))return[r[n+t]]}return null}function Le(e){let t=e.type.prop(Ne);return t?t(e.node):e}function Ie(e,t,r,n={}){let i=n.maxScanDistance||1e4,o=n.brackets||"()[]{}",s=ae(e),l=s.resolveInner(t,r);for(let n=l;n;n=n.parent){let i=Oe(n.type,r,o);if(i&&n.from<n.to){let s=Le(n);if(s&&(r>0?t>=s.from&&t<s.to:t>s.from&&t<=s.to))return Te(e,t,r,n,s,i,o)}}return function(e,t,r,n,i,o,s){let l=r<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),a=s.indexOf(l);if(a<0||a%2==0!=r>0)return null;let h={from:r<0?t-1:t,to:r>0?t+1:t},u=e.doc.iterRange(t,r>0?e.doc.length:0),f=0;for(let e=0;!u.next().done&&e<=o;){let o=u.value;r<0&&(e+=o.length);let l=t+e*r;for(let e=r>0?0:o.length-1,t=r>0?o.length:-1;e!=t;e+=r){let t=s.indexOf(o[e]);if(!(t<0||n.resolveInner(l+e,1).type!=i))if(t%2==0==r>0)f++;else{if(1==f)return{start:h,end:{from:l+e,to:l+e+1},matched:t>>1==a>>1};f--}}r>0&&(e+=o.length)}return u.done?{start:h,matched:!1}:null}(e,t,r,s,l.type,i,o)}function Te(e,t,r,n,i,o,s){let l=n.parent,a={from:i.from,to:i.to},h=0,u=null==l?void 0:l.cursor();if(u&&(r<0?u.childBefore(n.from):u.childAfter(n.to)))do{if(r<0?u.to<=n.from:u.from>=n.to){if(0==h&&o.indexOf(u.type.name)>-1&&u.from<u.to){let e=Le(u);return{start:a,end:e?{from:e.from,to:e.to}:void 0,matched:!0}}if(Oe(u.type,r,s))h++;else if(Oe(u.type,-r,s)){if(0==h){let e=Le(u);return{start:a,end:e&&e.from<e.to?{from:e.from,to:e.to}:void 0,matched:!1}}h--}}}while(r<0?u.prevSibling():u.nextSibling());return{start:a,matched:!1}}const _e=Object.create(null),Pe=[h.none],Re=[],ze=Object.create(null),Ve=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Ve[e]=Ue(_e,t);function Fe(e,t){Re.indexOf(e)>-1||(Re.push(e),console.warn(t))}function Ue(e,t){let r=[];for(let n of t.split(" ")){let t=[];for(let r of n.split(".")){let n=e[r]||re[r];n?"function"==typeof n?t.length?t=t.map(n):Fe(r,`Modifier ${r} used at start of tag`):t.length?Fe(r,`Tag ${r} used as modifier`):t=Array.isArray(n)?n:[n]:Fe(r,`Unknown highlighting tag ${r}`)}for(let e of t)r.push(e)}if(!r.length)return 0;let n=t.replace(/ /g,"_"),i=n+" "+r.map((e=>e.id)),o=ze[i];if(o)return o.id;let s=ze[i]=h.define({id:Pe.length,name:n,props:[z({[n]:r})]});return Pe.push(s),s.id}r.Direction.RTL,r.Direction.LTR;const We=e=>{let{state:t}=e,r=t.doc.lineAt(t.selection.main.from),n=Xe(e.state,r.from);return n.line?Ge(e):!!n.block&&Qe(e)};function Je(e,t){return({state:r,dispatch:n})=>{if(r.readOnly)return!1;let i=e(t,r);return!!i&&(n(r.update(i)),!0)}}const Ge=Je(et,0),je=Je(et,1),He=Je(et,2),$e=Je(Ze,0),qe=Je(Ze,1),Ke=Je(Ze,2),Qe=Je(((e,t)=>Ze(e,t,function(e){let t=[];for(let r of e.selection.ranges){let n=e.doc.lineAt(r.from),i=r.to<=n.to?n:e.doc.lineAt(r.to);i.from>n.from&&i.from==r.to&&(i=r.to==n.to+1?n:e.doc.lineAt(r.to-1));let o=t.length-1;o>=0&&t[o].to>n.from?t[o].to=i.to:t.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:i.to})}return t}(t))),0);function Xe(e,t){let r=e.languageDataAt("commentTokens",t,1);return r.length?r[0]:{}}const Ye=50;function Ze(e,t,r=t.selection.ranges){let n=r.map((e=>Xe(t,e.from).block));if(!n.every((e=>e)))return null;let i=r.map(((e,r)=>function(e,{open:t,close:r},n,i){let o,s,l=e.sliceDoc(n-Ye,n),a=e.sliceDoc(i,i+Ye),h=/\s*$/.exec(l)[0].length,u=/^\s*/.exec(a)[0].length,f=l.length-h;if(l.slice(f-t.length,f)==t&&a.slice(u,u+r.length)==r)return{open:{pos:n-h,margin:h&&1},close:{pos:i+u,margin:u&&1}};i-n<=2*Ye?o=s=e.sliceDoc(n,i):(o=e.sliceDoc(n,n+Ye),s=e.sliceDoc(i-Ye,i));let c=/^\s*/.exec(o)[0].length,d=/\s*$/.exec(s)[0].length,p=s.length-d-r.length;return o.slice(c,c+t.length)==t&&s.slice(p,p+r.length)==r?{open:{pos:n+c+t.length,margin:/\s/.test(o.charAt(c+t.length))?1:0},close:{pos:i-d-r.length,margin:/\s/.test(s.charAt(p-1))?1:0}}:null}(t,n[r],e.from,e.to)));if(2!=e&&!i.every((e=>e)))return{changes:t.changes(r.map(((e,t)=>i[t]?[]:[{from:e.from,insert:n[t].open+" "},{from:e.to,insert:" "+n[t].close}])))};if(1!=e&&i.some((e=>e))){let e=[];for(let t,r=0;r<i.length;r++)if(t=i[r]){let i=n[r],{open:o,close:s}=t;e.push({from:o.pos-i.open.length,to:o.pos+o.margin},{from:s.pos-s.margin,to:s.pos+i.close.length})}return{changes:e}}return null}function et(e,t,r=t.selection.ranges){let n=[],i=-1;for(let{from:e,to:o}of r){let r=n.length,s=1e9,l=Xe(t,e).line;if(l){for(let r=e;r<=o;){let a=t.doc.lineAt(r);if(a.from>i&&(e==o||o>a.from)){i=a.from;let e=/^\s*/.exec(a.text)[0].length,t=e==a.length,r=a.text.slice(e,e+l.length)==l?e:-1;e<a.text.length&&e<s&&(s=e),n.push({line:a,comment:r,token:l,indent:e,empty:t,single:!1})}r=a.to+1}if(s<1e9)for(let e=r;e<n.length;e++)n[e].indent<n[e].line.text.length&&(n[e].indent=s);n.length==r+1&&(n[r].single=!0)}}if(2!=e&&n.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:r,indent:i,empty:o,single:s}of n)!s&&o||e.push({from:t.from+i,insert:r+" "});let r=t.changes(e);return{changes:r,selection:t.selection.map(r,1)}}if(1!=e&&n.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:r,token:i}of n)if(r>=0){let n=t.from+r,o=n+i.length;" "==t.text[o-t.from]&&o++,e.push({from:n,to:o})}return{changes:e}}return null}const tt=t.Annotation.define(),rt=t.Annotation.define(),nt=t.Facet.define(),it=t.Facet.define({combine:e=>t.combineConfig(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(r,n)=>e(r,n)||t(r,n)})}),ot=t.StateField.define({create:()=>Ct.empty,update(e,r){let n=r.state.facet(it),i=r.annotation(tt);if(i){let t=mt.fromTransaction(r,i.selection),o=i.side,s=0==o?e.undone:e.done;return s=t?gt(s,s.length,n.minDepth,t):xt(s,r.startState.selection),new Ct(0==o?i.rest:s,0==o?s:i.rest)}let o=r.annotation(rt);if("full"!=o&&"before"!=o||(e=e.isolate()),!1===r.annotation(t.Transaction.addToHistory))return r.changes.empty?e:e.addMapping(r.changes.desc);let s=mt.fromTransaction(r),l=r.annotation(t.Transaction.time),a=r.annotation(t.Transaction.userEvent);return s?e=e.addChanges(s,l,a,n,r):r.selection&&(e=e.addSelection(r.startState.selection,l,a,n.newGroupDelay)),"full"!=o&&"after"!=o||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new Ct(e.done.map(mt.fromJSON),e.undone.map(mt.fromJSON))});const st=ot;function lt(e,t){return function({state:r,dispatch:n}){if(!t&&r.readOnly)return!1;let i=r.field(ot,!1);if(!i)return!1;let o=i.pop(e,r,t);return!!o&&(n(o),!0)}}const at=lt(0,!1),ht=lt(1,!1),ut=lt(0,!0),ft=lt(1,!0);function ct(e){return function(t){let r=t.field(ot,!1);if(!r)return 0;let n=0==e?r.done:r.undone;return n.length-(n.length&&!n[0].changes?1:0)}}const dt=ct(0),pt=ct(1);class mt{constructor(e,t,r,n,i){this.changes=e,this.effects=t,this.mapped=r,this.startSelection=n,this.selectionsAfter=i}setSelAfter(e){return new mt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,r;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(r=this.startSelection)||void 0===r?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new mt(e.changes&&t.ChangeSet.fromJSON(e.changes),[],e.mapped&&t.ChangeDesc.fromJSON(e.mapped),e.startSelection&&t.EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(t.EditorSelection.fromJSON))}static fromTransaction(e,t){let r=kt;for(let t of e.startState.facet(nt)){let n=t(e);n.length&&(r=r.concat(n))}return!r.length&&e.changes.empty?null:new mt(e.changes.invert(e.startState.doc),r,void 0,t||e.startState.selection,kt)}static selection(e){return new mt(void 0,kt,void 0,void 0,e)}}function gt(e,t,r,n){let i=t+1>r+20?t-r-1:0,o=e.slice(i,t);return o.push(n),o}function yt(e,t){return e.length?t.length?e.concat(t):e:t}const kt=[],wt=200;function xt(e,t){if(e.length){let r=e[e.length-1],n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-wt));return n.length&&n[n.length-1].eq(t)?e:(n.push(t),gt(e,e.length-1,1e9,r.setSelAfter(n)))}return[mt.selection([t])]}function vt(e){let t=e[e.length-1],r=e.slice();return r[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),r}function bt(e,t){if(!e.length)return e;let r=e.length,n=kt;for(;r;){let i=St(e[r-1],t,n);if(i.changes&&!i.changes.empty||i.effects.length){let t=e.slice(0,r);return t[r-1]=i,t}t=i.mapped,r--,n=i.selectionsAfter}return n.length?[mt.selection(n)]:kt}function St(e,r,n){let i=yt(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(r))):kt,n);if(!e.changes)return mt.selection(i);let o=e.changes.map(r),s=r.mapDesc(e.changes,!0),l=e.mapped?e.mapped.composeDesc(s):s;return new mt(o,t.StateEffect.mapEffects(e.effects,r),l,e.startSelection.map(s),i)}const At=/^(input\.type|delete)($|\.)/;class Ct{constructor(e,t,r=0,n=void 0){this.done=e,this.undone=t,this.prevTime=r,this.prevUserEvent=n}isolate(){return this.prevTime?new Ct(this.done,this.undone):this}addChanges(e,r,n,i,o){let s=this.done,l=s[s.length-1];return s=l&&l.changes&&!l.changes.empty&&e.changes&&(!n||At.test(n))&&(!l.selectionsAfter.length&&r-this.prevTime<i.newGroupDelay&&i.joinToEvent(o,function(e,t){let r=[],n=!1;return e.iterChangedRanges(((e,t)=>r.push(e,t))),t.iterChangedRanges(((e,t,i,o)=>{for(let e=0;e<r.length;){let t=r[e++],s=r[e++];o>=t&&i<=s&&(n=!0)}})),n}(l.changes,e.changes))||"input.type.compose"==n)?gt(s,s.length-1,i.minDepth,new mt(e.changes.compose(l.changes),yt(t.StateEffect.mapEffects(e.effects,l.changes),l.effects),l.mapped,l.startSelection,kt)):gt(s,s.length,i.minDepth,e),new Ct(s,kt,r,n)}addSelection(e,t,r,n){let i=this.done.length?this.done[this.done.length-1].selectionsAfter:kt;return i.length>0&&t-this.prevTime<n&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&(o=i[i.length-1],s=e,o.ranges.length==s.ranges.length&&0===o.ranges.filter(((e,t)=>e.empty!=s.ranges[t].empty)).length)?this:new Ct(xt(this.done,e),this.undone,t,r);var o,s}addMapping(e){return new Ct(bt(this.done,e),bt(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,r){let n=0==e?this.done:this.undone;if(0==n.length)return null;let i=n[n.length-1],o=i.selectionsAfter[0]||t.selection;if(r&&i.selectionsAfter.length)return t.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:tt.of({side:e,rest:vt(n),selection:o}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(i.changes){let r=1==n.length?kt:n.slice(0,n.length-1);return i.mapped&&(r=bt(r,i.mapped)),t.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:tt.of({side:e,rest:r,selection:o}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}Ct.empty=new Ct(kt,kt);const Bt=[{key:"Mod-z",run:at,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:ht,preventDefault:!0},{linux:"Ctrl-Shift-z",run:ht,preventDefault:!0},{key:"Mod-u",run:ut,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:ft,preventDefault:!0}];function Et(e,r){return t.EditorSelection.create(e.ranges.map(r),e.mainIndex)}function Dt(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function Mt({state:e,dispatch:t},r){let n=Et(e.selection,r);return!n.eq(e.selection,!0)&&(t(Dt(e,n)),!0)}function Nt(e,r){return t.EditorSelection.cursor(r?e.to:e.from)}function Ot(e,t){return Mt(e,(r=>r.empty?e.moveByChar(r,t):Nt(r,t)))}function Lt(e){return e.textDirectionAt(e.state.selection.main.head)==r.Direction.LTR}const It=e=>Ot(e,!Lt(e)),Tt=e=>Ot(e,Lt(e));function _t(e,r,n){let i=r.head,o=e.doc.lineAt(i);return i=i==(n?o.to:o.from)?n?Math.min(e.doc.length,o.to+1):Math.max(0,o.from-1):o.from+t.findClusterBreak(o.text,i-o.from,n),t.EditorSelection.cursor(i,n?-1:1)}function Pt(e,t){return Mt(e,(r=>r.empty?_t(e.state,r,t):Nt(r,t)))}function Rt(e,t){return Mt(e,(r=>r.empty?e.moveByGroup(r,t):Nt(r,t)))}const zt=e=>Rt(e,!Lt(e)),Vt=e=>Rt(e,Lt(e));function Ft(e,r,n){let i=e.state.charCategorizer(r),o=i(n),s=o!=t.CharCategory.Space;return e=>{let r=i(e);return r!=t.CharCategory.Space?s&&r==o:(s=!1,!0)}}const Ut="undefined"!=typeof Intl&&Intl.Segmenter?new Intl.Segmenter(void 0,{granularity:"word"}):null;function Wt(e,r,n){let i=e.state.charCategorizer(r.from),o=t.CharCategory.Space,s=r.from,l=0,a=!1,h=!1,u=!1,f=r=>{if(a)return!1;s+=n?r.length:-r.length;let f,c=i(r);if(c==t.CharCategory.Word&&r.charCodeAt(0)<128&&/[\W_]/.test(r)&&(c=-1),o==t.CharCategory.Space&&(o=c),o!=c)return!1;if(o==t.CharCategory.Word)if(r.toLowerCase()==r){if(!n&&h)return!1;u=!0}else if(u){if(n)return!1;a=!0}else{if(h&&n&&i(f=e.state.sliceDoc(s,s+1))==t.CharCategory.Word&&f.toLowerCase()==f)return!1;h=!0}return l++,!0},c=e.moveByChar(r,n,(e=>(f(e),f)));if(Ut&&o==t.CharCategory.Word&&c.from==r.from+l*(n?1:-1)){let i=Math.min(r.head,c.head),o=Math.max(r.head,c.head),s=e.state.sliceDoc(i,o);if(s.length>1&&/[\u4E00-\uffff]/.test(s)){let e=Array.from(Ut.segment(s));if(e.length>1)return n?t.EditorSelection.cursor(r.head+e[1].index,-1):t.EditorSelection.cursor(c.head+e[e.length-1].index,1)}}return c}function Jt(e,t){return Mt(e,(r=>r.empty?Wt(e,r,t):Nt(r,t)))}function Gt(e,t,r){if(t.type.prop(r))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function jt(e,r,n){let i,o,l=ae(e).resolveInner(r.head),a=n?s.closedBy:s.openedBy;for(let t=r.head;;){let r=n?l.childAfter(t):l.childBefore(t);if(!r)break;Gt(e,r,a)?l=r:t=n?r.to:r.from}return o=l.type.prop(a)&&(i=n?Ie(e,l.from,1):Ie(e,l.to,-1))&&i.matched?n?i.end.to:i.end.from:n?l.to:l.from,t.EditorSelection.cursor(o,n?-1:1)}const Ht=e=>Mt(e,(t=>jt(e.state,t,!Lt(e)))),$t=e=>Mt(e,(t=>jt(e.state,t,Lt(e))));function qt(e,t){return Mt(e,(r=>{if(!r.empty)return Nt(r,t);let n=e.moveVertically(r,t);return n.head!=r.head?n:e.moveToLineBoundary(r,t)}))}const Kt=e=>qt(e,!1),Qt=e=>qt(e,!0);function Xt(e){let t,n=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,i=0,o=0;if(n){for(let t of e.state.facet(r.EditorView.scrollMargins)){let r=t(e);(null==r?void 0:r.top)&&(i=Math.max(null==r?void 0:r.top,i)),(null==r?void 0:r.bottom)&&(o=Math.max(null==r?void 0:r.bottom,o))}t=e.scrollDOM.clientHeight-i-o}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:i,marginBottom:o,selfScroll:n,height:Math.max(e.defaultLineHeight,t-5)}}function Yt(e,t){let n,i=Xt(e),{state:o}=e,s=Et(o.selection,(r=>r.empty?e.moveVertically(r,t,i.height):Nt(r,t)));if(s.eq(o.selection))return!1;if(i.selfScroll){let t=e.coordsAtPos(o.selection.main.head),l=e.scrollDOM.getBoundingClientRect(),a=l.top+i.marginTop,h=l.bottom-i.marginBottom;t&&t.top>a&&t.bottom<h&&(n=r.EditorView.scrollIntoView(s.main.head,{y:"start",yMargin:t.top-a}))}return e.dispatch(Dt(o,s),{effects:n}),!0}const Zt=e=>Yt(e,!1),er=e=>Yt(e,!0);function tr(e,r,n){let i=e.lineBlockAt(r.head),o=e.moveToLineBoundary(r,n);if(o.head==r.head&&o.head!=(n?i.to:i.from)&&(o=e.moveToLineBoundary(r,n,!1)),!n&&o.head==i.from&&i.length){let n=/^\s*/.exec(e.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;n&&r.head!=i.from+n&&(o=t.EditorSelection.cursor(i.from+n))}return o}const rr=e=>Mt(e,(t=>tr(e,t,!0))),nr=e=>Mt(e,(t=>tr(e,t,!1))),ir=e=>Mt(e,(t=>tr(e,t,!Lt(e)))),or=e=>Mt(e,(t=>tr(e,t,Lt(e)))),sr=e=>Mt(e,(r=>t.EditorSelection.cursor(e.lineBlockAt(r.head).from,1))),lr=e=>Mt(e,(r=>t.EditorSelection.cursor(e.lineBlockAt(r.head).to,-1)));function ar(e,r,n){let i=!1,o=Et(e.selection,(r=>{let o=Ie(e,r.head,-1)||Ie(e,r.head,1)||r.head>0&&Ie(e,r.head-1,1)||r.head<e.doc.length&&Ie(e,r.head+1,-1);if(!o||!o.end)return r;i=!0;let s=o.start.from==r.head?o.end.to:o.end.from;return n?t.EditorSelection.range(r.anchor,s):t.EditorSelection.cursor(s)}));return!!i&&(r(Dt(e,o)),!0)}const hr=({state:e,dispatch:t})=>ar(e,t,!1);function ur(e,r){let n=Et(e.state.selection,(e=>{let n=r(e);return t.EditorSelection.range(e.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)}));return!n.eq(e.state.selection)&&(e.dispatch(Dt(e.state,n)),!0)}function fr(e,t){return ur(e,(r=>e.moveByChar(r,t)))}const cr=e=>fr(e,!Lt(e)),dr=e=>fr(e,Lt(e));function pr(e,t){return ur(e,(r=>e.moveByGroup(r,t)))}const mr=e=>pr(e,!Lt(e)),gr=e=>pr(e,Lt(e));function yr(e,t){return ur(e,(r=>Wt(e,r,t)))}const kr=e=>ur(e,(t=>jt(e.state,t,!Lt(e)))),wr=e=>ur(e,(t=>jt(e.state,t,Lt(e))));function xr(e,t){return ur(e,(r=>e.moveVertically(r,t)))}const vr=e=>xr(e,!1),br=e=>xr(e,!0);function Sr(e,t){return ur(e,(r=>e.moveVertically(r,t,Xt(e).height)))}const Ar=e=>Sr(e,!1),Cr=e=>Sr(e,!0),Br=e=>ur(e,(t=>tr(e,t,!0))),Er=e=>ur(e,(t=>tr(e,t,!1))),Dr=e=>ur(e,(t=>tr(e,t,!Lt(e)))),Mr=e=>ur(e,(t=>tr(e,t,Lt(e)))),Nr=e=>ur(e,(r=>t.EditorSelection.cursor(e.lineBlockAt(r.head).from))),Or=e=>ur(e,(r=>t.EditorSelection.cursor(e.lineBlockAt(r.head).to))),Lr=({state:e,dispatch:t})=>(t(Dt(e,{anchor:0})),!0),Ir=({state:e,dispatch:t})=>(t(Dt(e,{anchor:e.doc.length})),!0),Tr=({state:e,dispatch:t})=>(t(Dt(e,{anchor:e.selection.main.anchor,head:0})),!0),_r=({state:e,dispatch:t})=>(t(Dt(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),Pr=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),Rr=({state:e,dispatch:r})=>{let n=Zr(e).map((({from:r,to:n})=>t.EditorSelection.range(r,Math.min(n+1,e.doc.length))));return r(e.update({selection:t.EditorSelection.create(n),userEvent:"select"})),!0},zr=({state:e,dispatch:r})=>{let n=Et(e.selection,(r=>{let n=ae(e),i=n.resolveStack(r.from,1);if(r.empty){let e=n.resolveStack(r.from,-1);e.node.from>=i.node.from&&e.node.to<=i.node.to&&(i=e)}for(let e=i;e;e=e.next){let{node:n}=e;if((n.from<r.from&&n.to>=r.to||n.to>r.to&&n.from<=r.from)&&e.next)return t.EditorSelection.range(n.to,n.from)}return r}));return!n.eq(e.selection)&&(r(Dt(e,n)),!0)},Vr=({state:e,dispatch:r})=>{let n=e.selection,i=null;return n.ranges.length>1?i=t.EditorSelection.create([n.main]):n.main.empty||(i=t.EditorSelection.create([t.EditorSelection.cursor(n.main.head)])),!!i&&(r(Dt(e,i)),!0)};function Fr(e,n){if(e.state.readOnly)return!1;let i="delete.selection",{state:o}=e,s=o.changeByRange((r=>{let{from:o,to:s}=r;if(o==s){let t=n(r);t<o?(i="delete.backward",t=Ur(e,t,!1)):t>o&&(i="delete.forward",t=Ur(e,t,!0)),o=Math.min(o,t),s=Math.max(s,t)}else o=Ur(e,o,!1),s=Ur(e,s,!0);return o==s?{range:r}:{changes:{from:o,to:s},range:t.EditorSelection.cursor(o,o<r.head?-1:1)}}));return!s.changes.empty&&(e.dispatch(o.update(s,{scrollIntoView:!0,userEvent:i,effects:"delete.selection"==i?r.EditorView.announce.of(o.phrase("Selection deleted")):void 0})),!0)}function Ur(e,t,n){if(e instanceof r.EditorView)for(let i of e.state.facet(r.EditorView.atomicRanges).map((t=>t(e))))i.between(t,t,((e,r)=>{e<t&&r>t&&(t=n?r:e)}));return t}const Wr=(e,r,n)=>Fr(e,(i=>{let o,s,l=i.from,{state:a}=e,h=a.doc.lineAt(l);if(n&&!r&&l>h.from&&l<h.from+200&&!/[^ \t]/.test(o=h.text.slice(0,l-h.from))){if("\t"==o[o.length-1])return l-1;let e=t.countColumn(o,a.tabSize)%xe(a)||xe(a);for(let t=0;t<e&&" "==o[o.length-1-t];t++)l--;s=l}else s=t.findClusterBreak(h.text,l-h.from,r,r)+h.from,s==l&&h.number!=(r?a.doc.lines:1)?s+=r?1:-1:!r&&/[\ufe00-\ufe0f]/.test(h.text.slice(s-h.from,l-h.from))&&(s=t.findClusterBreak(h.text,s-h.from,!1,!1)+h.from);return s})),Jr=e=>Wr(e,!1,!0),Gr=e=>Wr(e,!0,!1),jr=(e,r)=>Fr(e,(n=>{let i=n.head,{state:o}=e,s=o.doc.lineAt(i),l=o.charCategorizer(i);for(let e=null;;){if(i==(r?s.to:s.from)){i==n.head&&s.number!=(r?o.doc.lines:1)&&(i+=r?1:-1);break}let a=t.findClusterBreak(s.text,i-s.from,r)+s.from,h=s.text.slice(Math.min(i,a)-s.from,Math.max(i,a)-s.from),u=l(h);if(null!=e&&u!=e)break;" "==h&&i==n.head||(e=u),i=a}return i})),Hr=e=>jr(e,!1),$r=e=>jr(e,!0),qr=e=>Fr(e,(t=>{let r=e.lineBlockAt(t.head).to;return t.head<r?r:Math.min(e.state.doc.length,t.head+1)})),Kr=e=>Fr(e,(t=>{let r=e.moveToLineBoundary(t,!1).head;return t.head>r?r:Math.max(0,t.head-1)})),Qr=e=>Fr(e,(t=>{let r=e.moveToLineBoundary(t,!0).head;return t.head<r?r:Math.min(e.state.doc.length,t.head+1)})),Xr=({state:e,dispatch:r})=>{if(e.readOnly)return!1;let n=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:t.Text.of(["",""])},range:t.EditorSelection.cursor(e.from)})));return r(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},Yr=({state:e,dispatch:r})=>{if(e.readOnly)return!1;let n=e.changeByRange((r=>{if(!r.empty||0==r.from||r.from==e.doc.length)return{range:r};let n=r.from,i=e.doc.lineAt(n),o=n==i.from?n-1:t.findClusterBreak(i.text,n-i.from,!1)+i.from,s=n==i.to?n+1:t.findClusterBreak(i.text,n-i.from,!0)+i.from;return{changes:{from:o,to:s,insert:e.doc.slice(n,s).append(e.doc.slice(o,n))},range:t.EditorSelection.cursor(s)}}));return!n.changes.empty&&(r(e.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Zr(e){let t=[],r=-1;for(let n of e.selection.ranges){let i=e.doc.lineAt(n.from),o=e.doc.lineAt(n.to);if(n.empty||n.to!=o.from||(o=e.doc.lineAt(n.to-1)),r>=i.number){let e=t[t.length-1];e.to=o.to,e.ranges.push(n)}else t.push({from:i.from,to:o.to,ranges:[n]});r=o.number+1}return t}function en(e,r,n){if(e.readOnly)return!1;let i=[],o=[];for(let r of Zr(e)){if(n?r.to==e.doc.length:0==r.from)continue;let s=e.doc.lineAt(n?r.to+1:r.from-1),l=s.length+1;if(n){i.push({from:r.to,to:s.to},{from:r.from,insert:s.text+e.lineBreak});for(let n of r.ranges)o.push(t.EditorSelection.range(Math.min(e.doc.length,n.anchor+l),Math.min(e.doc.length,n.head+l)))}else{i.push({from:s.from,to:r.from},{from:r.to,insert:e.lineBreak+s.text});for(let e of r.ranges)o.push(t.EditorSelection.range(e.anchor-l,e.head-l))}}return!!i.length&&(r(e.update({changes:i,scrollIntoView:!0,selection:t.EditorSelection.create(o,e.selection.mainIndex),userEvent:"move.line"})),!0)}const tn=({state:e,dispatch:t})=>en(e,t,!1),rn=({state:e,dispatch:t})=>en(e,t,!0);function nn(e,t,r){if(e.readOnly)return!1;let n=[];for(let t of Zr(e))r?n.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):n.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const on=({state:e,dispatch:t})=>nn(e,t,!1),sn=({state:e,dispatch:t})=>nn(e,t,!0),ln=e=>{if(e.state.readOnly)return!1;let{state:t}=e,r=t.changes(Zr(t).map((({from:e,to:r})=>(e>0?e--:r<t.doc.length&&r++,{from:e,to:r})))),n=Et(t.selection,(t=>{let r;if(e.lineWrapping){let n=e.lineBlockAt(t.head),i=e.coordsAtPos(t.head,t.assoc||1);i&&(r=n.bottom+e.documentTop-i.bottom+e.defaultLineHeight/2)}return e.moveVertically(t,!0,r)})).map(r);return e.dispatch({changes:r,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};const an=un(!1),hn=un(!0);function un(e){return({state:r,dispatch:n})=>{if(r.readOnly)return!1;let i=r.changeByRange((n=>{let{from:i,to:o}=n,l=r.doc.lineAt(i),a=!e&&i==o&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let r,n=ae(e).resolveInner(t),i=n.childBefore(t),o=n.childAfter(t);return i&&o&&i.to<=t&&o.from>=t&&(r=i.type.prop(s.closedBy))&&r.indexOf(o.name)>-1&&e.doc.lineAt(i.to).from==e.doc.lineAt(o.from).from&&!/\S/.test(e.sliceDoc(i.to,o.from))?{from:i.to,to:o.from}:null}(r,i);e&&(i=o=(o<=l.to?l:r.doc.lineAt(o)).to);let h=new Se(r,{simulateBreak:i,simulateDoubleBreak:!!a}),u=be(h,i);for(null==u&&(u=t.countColumn(/^\s*/.exec(r.doc.lineAt(i).text)[0],r.tabSize));o<l.to&&/\s/.test(l.text[o-l.from]);)o++;a?({from:i,to:o}=a):i>l.from&&i<l.from+100&&!/\S/.test(l.text.slice(0,i))&&(i=l.from);let f=["",ve(r,u)];return a&&f.push(ve(r,h.lineIndent(l.from,-1))),{changes:{from:i,to:o,insert:t.Text.of(f)},range:t.EditorSelection.cursor(i+1+f[1].length)}}));return n(r.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function fn(e,r){let n=-1;return e.changeByRange((i=>{let o=[];for(let t=i.from;t<=i.to;){let s=e.doc.lineAt(t);s.number>n&&(i.empty||i.to>s.from)&&(r(s,o,i),n=s.number),t=s.to+1}let s=e.changes(o);return{changes:o,range:t.EditorSelection.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}}))}const cn=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=Object.create(null),n=new Se(e,{overrideIndentation:e=>{let t=r[e];return null==t?-1:t}}),i=fn(e,((t,i,o)=>{let s=be(n,t.from);if(null==s)return;/\S/.test(t.text)||(s=0);let l=/^\s*/.exec(t.text)[0],a=ve(e,s);(l!=a||o.from<t.from+l.length)&&(r[t.from]=s,i.push({from:t.from,to:t.from+l.length,insert:a}))}));return i.changes.empty||t(e.update(i,{userEvent:"indent"})),!0},dn=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(fn(e,((t,r)=>{r.push({from:t.from,insert:e.facet(we)})})),{userEvent:"input.indent"})),!0),pn=({state:e,dispatch:r})=>!e.readOnly&&(r(e.update(fn(e,((r,n)=>{let i=/^\s*/.exec(r.text)[0];if(!i)return;let o=t.countColumn(i,e.tabSize),s=0,l=ve(e,Math.max(0,o-xe(e)));for(;s<i.length&&s<l.length&&i.charCodeAt(s)==l.charCodeAt(s);)s++;n.push({from:r.from+s,to:r.from+i.length,insert:l.slice(s)})})),{userEvent:"delete.dedent"})),!0),mn=e=>(e.setTabFocusMode(),!0),gn=[{key:"Ctrl-b",run:It,shift:cr,preventDefault:!0},{key:"Ctrl-f",run:Tt,shift:dr},{key:"Ctrl-p",run:Kt,shift:vr},{key:"Ctrl-n",run:Qt,shift:br},{key:"Ctrl-a",run:sr,shift:Nr},{key:"Ctrl-e",run:lr,shift:Or},{key:"Ctrl-d",run:Gr},{key:"Ctrl-h",run:Jr},{key:"Ctrl-k",run:qr},{key:"Ctrl-Alt-h",run:Hr},{key:"Ctrl-o",run:Xr},{key:"Ctrl-t",run:Yr},{key:"Ctrl-v",run:er}],yn=[{key:"ArrowLeft",run:It,shift:cr,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:zt,shift:mr,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:ir,shift:Dr,preventDefault:!0},{key:"ArrowRight",run:Tt,shift:dr,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Vt,shift:gr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:or,shift:Mr,preventDefault:!0},{key:"ArrowUp",run:Kt,shift:vr,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Lr,shift:Tr},{mac:"Ctrl-ArrowUp",run:Zt,shift:Ar},{key:"ArrowDown",run:Qt,shift:br,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Ir,shift:_r},{mac:"Ctrl-ArrowDown",run:er,shift:Cr},{key:"PageUp",run:Zt,shift:Ar},{key:"PageDown",run:er,shift:Cr},{key:"Home",run:nr,shift:Er,preventDefault:!0},{key:"Mod-Home",run:Lr,shift:Tr},{key:"End",run:rr,shift:Br,preventDefault:!0},{key:"Mod-End",run:Ir,shift:_r},{key:"Enter",run:an,shift:an},{key:"Mod-a",run:Pr},{key:"Backspace",run:Jr,shift:Jr},{key:"Delete",run:Gr},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Hr},{key:"Mod-Delete",mac:"Alt-Delete",run:$r},{mac:"Mod-Backspace",run:Kr},{mac:"Mod-Delete",run:Qr}].concat(gn.map((e=>({mac:e.key,run:e.run,shift:e.shift})))),kn=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Ht,shift:kr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:$t,shift:wr},{key:"Alt-ArrowUp",run:tn},{key:"Shift-Alt-ArrowUp",run:on},{key:"Alt-ArrowDown",run:rn},{key:"Shift-Alt-ArrowDown",run:sn},{key:"Escape",run:Vr},{key:"Mod-Enter",run:hn},{key:"Alt-l",mac:"Ctrl-l",run:Rr},{key:"Mod-i",run:zr,preventDefault:!0},{key:"Mod-[",run:pn},{key:"Mod-]",run:dn},{key:"Mod-Alt-\\",run:cn},{key:"Shift-Mod-k",run:ln},{key:"Shift-Mod-\\",run:hr},{key:"Mod-/",run:We},{key:"Alt-A",run:$e},{key:"Ctrl-m",mac:"Shift-Alt-m",run:mn}].concat(yn),wn={key:"Tab",run:dn,shift:pn};return e.blockComment=qe,e.blockUncomment=Ke,e.copyLineDown=sn,e.copyLineUp=on,e.cursorCharBackward=e=>Ot(e,!1),e.cursorCharBackwardLogical=e=>Pt(e,!1),e.cursorCharForward=e=>Ot(e,!0),e.cursorCharForwardLogical=e=>Pt(e,!0),e.cursorCharLeft=It,e.cursorCharRight=Tt,e.cursorDocEnd=Ir,e.cursorDocStart=Lr,e.cursorGroupBackward=e=>Rt(e,!1),e.cursorGroupForward=e=>Rt(e,!0),e.cursorGroupForwardWin=e=>Mt(e,(t=>t.empty?e.moveByChar(t,!0,(r=>Ft(e,t.head,r))):Nt(t,!0))),e.cursorGroupLeft=zt,e.cursorGroupRight=Vt,e.cursorLineBoundaryBackward=nr,e.cursorLineBoundaryForward=rr,e.cursorLineBoundaryLeft=ir,e.cursorLineBoundaryRight=or,e.cursorLineDown=Qt,e.cursorLineEnd=lr,e.cursorLineStart=sr,e.cursorLineUp=Kt,e.cursorMatchingBracket=hr,e.cursorPageDown=er,e.cursorPageUp=Zt,e.cursorSubwordBackward=e=>Jt(e,!1),e.cursorSubwordForward=e=>Jt(e,!0),e.cursorSyntaxLeft=Ht,e.cursorSyntaxRight=$t,e.defaultKeymap=kn,e.deleteCharBackward=Jr,e.deleteCharBackwardStrict=e=>Wr(e,!1,!1),e.deleteCharForward=Gr,e.deleteGroupBackward=Hr,e.deleteGroupForward=$r,e.deleteLine=ln,e.deleteLineBoundaryBackward=Kr,e.deleteLineBoundaryForward=Qr,e.deleteToLineEnd=qr,e.deleteToLineStart=e=>Fr(e,(t=>{let r=e.lineBlockAt(t.head).from;return t.head>r?r:Math.max(0,t.head-1)})),e.deleteTrailingWhitespace=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=[];for(let t=0,n="",i=e.doc.iter();;){if(i.next(),i.lineBreak||i.done){let e=n.search(/\s+$/);if(e>-1&&r.push({from:t-(n.length-e),to:t}),i.done)break;n=""}else n=i.value;t+=i.value.length}return!!r.length&&(t(e.update({changes:r,userEvent:"delete"})),!0)},e.emacsStyleKeymap=gn,e.history=function(e={}){return[ot,it.of(e),r.EditorView.domEventHandlers({beforeinput(e,t){let r="historyUndo"==e.inputType?at:"historyRedo"==e.inputType?ht:null;return!!r&&(e.preventDefault(),r(t))}})]},e.historyField=st,e.historyKeymap=Bt,e.indentLess=pn,e.indentMore=dn,e.indentSelection=cn,e.indentWithTab=wn,e.insertBlankLine=hn,e.insertNewline=({state:e,dispatch:t})=>(t(e.update(e.replaceSelection(e.lineBreak),{scrollIntoView:!0,userEvent:"input"})),!0),e.insertNewlineAndIndent=an,e.insertNewlineKeepIndent=({state:e,dispatch:r})=>(r(e.update(e.changeByRange((r=>{let n=/^\s*/.exec(e.doc.lineAt(r.from).text)[0];return{changes:{from:r.from,to:r.to,insert:e.lineBreak+n},range:t.EditorSelection.cursor(r.from+n.length+1)}})),{scrollIntoView:!0,userEvent:"input"})),!0),e.insertTab=({state:e,dispatch:t})=>e.selection.ranges.some((e=>!e.empty))?dn({state:e,dispatch:t}):(t(e.update(e.replaceSelection("\t"),{scrollIntoView:!0,userEvent:"input"})),!0),e.invertedEffects=nt,e.isolateHistory=rt,e.lineComment=je,e.lineUncomment=He,e.moveLineDown=rn,e.moveLineUp=tn,e.redo=ht,e.redoDepth=pt,e.redoSelection=ft,e.selectAll=Pr,e.selectCharBackward=e=>fr(e,!1),e.selectCharBackwardLogical=e=>ur(e,(t=>_t(e.state,t,!1))),e.selectCharForward=e=>fr(e,!0),e.selectCharForwardLogical=e=>ur(e,(t=>_t(e.state,t,!0))),e.selectCharLeft=cr,e.selectCharRight=dr,e.selectDocEnd=_r,e.selectDocStart=Tr,e.selectGroupBackward=e=>pr(e,!1),e.selectGroupForward=e=>pr(e,!0),e.selectGroupForwardWin=e=>ur(e,(t=>e.moveByChar(t,!0,(r=>Ft(e,t.head,r))))),e.selectGroupLeft=mr,e.selectGroupRight=gr,e.selectLine=Rr,e.selectLineBoundaryBackward=Er,e.selectLineBoundaryForward=Br,e.selectLineBoundaryLeft=Dr,e.selectLineBoundaryRight=Mr,e.selectLineDown=br,e.selectLineEnd=Or,e.selectLineStart=Nr,e.selectLineUp=vr,e.selectMatchingBracket=({state:e,dispatch:t})=>ar(e,t,!0),e.selectPageDown=Cr,e.selectPageUp=Ar,e.selectParentSyntax=zr,e.selectSubwordBackward=e=>yr(e,!1),e.selectSubwordForward=e=>yr(e,!0),e.selectSyntaxLeft=kr,e.selectSyntaxRight=wr,e.simplifySelection=Vr,e.splitLine=Xr,e.standardKeymap=yn,e.temporarilySetTabFocusMode=e=>(e.setTabFocusMode(2e3),!0),e.toggleBlockComment=$e,e.toggleBlockCommentByLine=Qe,e.toggleComment=We,e.toggleLineComment=Ge,e.toggleTabFocusMode=mn,e.transposeChars=Yr,e.undo=at,e.undoDepth=dt,e.undoSelection=ut,e}({},CM.state,CM.view);
